# 卡尔曼滤波

## 引言

通俗的讲，卡尔曼滤波就是同时考虑 **观测值** 和 **预测值**，使得观测值存在很大偏差时输出不会有很大的波动；

下面是一个例子：

对于一个移动的机器人：

在某时刻我们可以得到以下 已知参数：

* **观测值**，比如由传感器直接测量机器人离目标距离7m，

* 上个时刻机器人离目标距离

* 机器人自己当前时刻的速度

  由上时刻位置和当前速度可以估算出一个位置，称为**估计值**。比如：上一秒离目标10m，速度是4m/s，那么现在这秒估计就离目标距离是6m。

假如传感器测量的准确度是 0.9， 估算的准确度是 0.8

最终输出的结果则是综合上述两个值的算数加权平均：
$$
result = \frac{0.8}{0.9+0.8} \times 6 + \frac{0.9}{0.9+0.8}
$$
实际问题中控制对象的模型可能更复杂，比如火箭和导弹的控制会用到状态空间控制，**速度、导弹位置、雷达测距的测量值这些都服从正态分布**；同时准确度不是简单的用一个确定的概率描述，而是使用高斯概率密度分布函数；
$$
\begin{cases} x_{k+1} = A_k x_k + B_k u_k + w_k\\y_k = C_K x_k + D_k u_k + v_k \\ \end{cases}
$$
其中：

* x  是状态变量 —— 每个时刻的位置
* u 是外界输入
* y 是可直接测量的输出
* w和v 都是服从正态分布的噪声

因此除了 u 是确定的，其他变量都是随机变量，服从高斯分布



## 推导过程

从 k = 0 出发，我们知道 x0 和  y0都是高斯分布，假设通过观测我们知道 y0 = 1，此时y0不再是随机变量，而是确定了，而此时 x0 由于不能直接观测，因此需要估计，这里用到的一个算法就是最小均方根法，类似于最小二乘法，用于计算最优值，直接给出公式，最优的 $x_0$ :
$$
\hat{x_0} = E(X|Y = y)
$$
条件高斯分布仍为高斯分布，且其均值计算有公式：
$$
条件高斯均值和方差
$$
![image-20221217164847876](C:/Users/Lee Ouch/AppData/Roaming/Typora/typora-user-images/image-20221217164847876.png)

这样我们就通过观测的值得到了最优估计值；

接下来的任务就是，如果通过下一次的 观测值 y1 继续估计 最优x1，可以重复上述方法，但是随着维数的增加计算量会急速增大；因此卡尔曼滤波通过递归的方法，通过此次结果迭代出下一次结果：

上一步中我们的随机变量是 x0  ，而经过最优估计后随机比变量成为 (x0|y0 =1 )，高斯分布的条件分布仍服从高斯分布，此时我们可以把  (x0|y0 =1 ) 看成一个新的随机变量， 记为 **Z** ，则当观测到新的观测值 y1 时，我们又得到了一个新的条件高斯分布 (Z|y1 = 1)，重复最小均方根算法就可以得到最优的 **x1**

继续迭代下去就能一系列最优状态值 **$X$** 这就是卡尔曼滤波算法





## 具体到项目

[这篇讲挺好](https://blog.csdn.net/m0_56116736/article/details/123328989)，现在算是明白了，老师上课讲的是最难的情况，实际用的之后模型远没有这么复杂，只需要将其简化就行了；



## 中期后优化

由于中期前机械结构存在较大问题，因此滤波的效果不够明显，而且可观察性也不够好，因此接下来几天完成机械装配的改进后，开始研究更智能的滤波算法，需要做以下工作：

\* 补充之前调参的对照组图像，大概需要4组数据；done
\* 绘制目前阶段过滤后的图像，观察分析需要如何改进  done
\* 设计算法，如何判断出现抖动，这就需要知道抖动的波形，以及正常工作时的波形



### 关于噪声

之前一直说这个过程中会有噪声，所以要用滤波算法处理，那么现在来分析一下噪声：

1. **噪声从哪里来？？？**
   * 传感器的噪声：目前看来，AB相编码器的精度较高，噪声几乎可以忽略不计；便宜的模拟量编码器抖动稍微大一点，但是基础的滤波就可以有效处理
   * 人手的抖动，通过自己实验尝试，人在保持一个动作静止不动时确实会有一些不可避免的手部抖动；除此之外还有别的吗
   * 还有什么噪声？？？







### 关于自适应卡尔曼

标准啊的自适应卡尔曼滤波是根据实时的状态调节 Ｑ　和　R，但是我这里不用搞这么复杂，我想实现的就是有噪声的时候用较小的Q，
